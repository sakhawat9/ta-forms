let wHelp=document.querySelectorAll(".wHelp"),wHelpMulti=document.querySelectorAll(".wHelp-multi"),wHelpButton=document.querySelector(".wHelp_button"),wHelpBubble=document.querySelectorAll(".wHelp-bubble"),wHelpCurrentTime=document.querySelector(".current-time"),wHelpUserAvailability=document.querySelectorAll(".wHelpUserAvailability"),wHelpMultiPopupContent=document.querySelector(".wHelp-multi__popup__content"),wHelpMultiUser=document.querySelectorAll(".user"),wHelpCheckboxDiv=document.querySelectorAll(".wHelp--checkbox"),wHelpCheckbox=document.querySelectorAll(".wHelp__checkbox"),wHelpCheckButton=document.querySelectorAll(".wHelp__send-message"),wHelpPopupContent=document.querySelectorAll(".wHelp__popup__content"),autoShowPopup=whatshelp_pro_frontend_script.autoShowPopup,autoOpenPopupTimeout=whatshelp_pro_frontend_script.autoOpenPopupTimeout,analytics_parameter=whatshelp_pro_frontend_script.analytics_parameter.google_analytics_parameter,event_name=whatshelp_pro_frontend_script.analytics_parameter.event_name,today=(document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".ta_forms_analytics").forEach(e=>{e.addEventListener("click",function(){let t=this.getAttribute("data-number")||"",a=this.getAttribute("data-group")||"";var e=JSON.parse(JSON.stringify(analytics_parameter));e.forEach(e=>{"number"===e.event_parameter?e.event_parameter_value=t:"group"===e.event_parameter&&(e.event_parameter_value=a)});let o={};e.forEach(e=>{o[e.event_parameter]=e.event_parameter_value}),"undefined"!=typeof gtag&&gtag("event",event_name,o)})})}),new Date);if(null!==wHelpCurrentTime){let e=today.getHours()+":"+today.getMinutes()+":"+today.getSeconds();wHelpCurrentTime.innerText=e}let openChatBtn=e=>{e.preventDefault(),wHelp.forEach(e=>{e.classList?.toggle("wHelp-show")}),wHelpMulti.forEach(e=>{e.classList?.toggle("wHelp-show")})},wHelpCheckboxValue=(wHelpBubble.forEach(e=>{wHelpButton||e.addEventListener("click",openChatBtn)}),"true"===localStorage.getItem("wHelpCheckboxValue"));function is_available(e,t){let a=!1,o=!1;for(var l in e){var i;e.hasOwnProperty(l)&&get_day_of_week(l)==t.day()&&(l=e[l].split("-"),i=moment.tz(l[0],"HH:mm",t.tz()),l=moment.tz(l[1],"HH:mm",t.tz()),i.year(t.year()).month(t.month()).date(t.date()),l.year(t.year()).month(t.month()).date(t.date()),t.isBetween(i,l)?a=!0:t.isBefore(i)&&(o=!0))}return{is_available:a,almost_available:o}}function get_day_of_week(e){return"sunday"==(e=e.toLowerCase())?0:"monday"==e?1:"tuesday"==e?2:"wednesday"==e?3:"thursday"==e?4:"friday"==e?5:"saturday"==e?6:void 0}wHelpCheckboxValue&&(wHelpMultiUser.forEach(e=>{e?.classList.contains("condition__checked")&&e.classList.remove("condition__checked")}),wHelpCheckButton.forEach(e=>{e?.classList.contains("condition__checked")&&e.classList.remove("condition__checked")}),wHelpCheckboxDiv)&&wHelpCheckboxDiv.forEach(e=>{e.style.display="none"}),wHelpCheckbox?.forEach(e=>{e?.addEventListener("change",function(){this.checked&&(wHelpCheckButton.forEach(e=>{e?.classList.contains("condition__checked")&&e.classList.remove("condition__checked")}),wHelpUserAvailability&&wHelpUserAvailability.forEach(e=>{e.classList.remove("condition__checked")}),wHelpCheckboxDiv&&wHelpCheckboxDiv.forEach(e=>{e.style.display="none"}),localStorage.setItem("wHelpCheckboxValue",this.checked))})});let searchInfo=wHelpMultiPopupContent?.getAttribute("data-search"),isGrid=document.querySelector(".wHelp-multi")?.classList.contains("wHelp-grid");function searchUser(){for(var e,t=!1,a=document.getElementById("search-input").value.toUpperCase(),o=document.getElementById("multi-user").getElementsByClassName("user"),l=document.querySelector(".no-results"),i=0;i<o.length;i++)-1<((e=o[i].getElementsByClassName("user__info--name")[0]).textContent||e.innerText).toUpperCase().indexOf(a)?t=!(o[i].style.display=""):o[i].style.display="none";l.style.display=t?"none":"block"}void 0!==wHelpUserAvailability&&("true"===searchInfo&&wHelpMultiPopupContent.classList.add("wHelp-search"),3<wHelpUserAvailability.length&&!isGrid&&wHelpMultiPopupContent.classList.add("wHelp-scroll"),4<wHelpUserAvailability.length&&isGrid&&wHelpMultiPopupContent.classList.add("wHelp-scroll"),wHelpUserAvailability.forEach(e=>{let t=e.getAttribute("data-userAvailability");e=e.getAttribute("data-timezone"),e=e?moment().tz(e):moment();is_available(JSON.parse(t),e).is_available||null==t?wHelpUserAvailability.forEach(e=>{e.getAttribute("data-userAvailability")===t&&(e.classList.add("avatar-active"),e.classList.remove("avatar-inactive"),e.classList.add("ta_forms_analytics"))}):wHelpUserAvailability.forEach(e=>{e.getAttribute("data-userAvailability")===t&&(e.classList.add("avatar-inactive"),e.setAttribute("disabled",""),e.classList.remove("avatar-active"),e.classList.remove("ta_forms_analytics"))})}));let wHelpButtons=document.querySelectorAll(".wHelpButtons"),chatAvailability=(void 0!==wHelpButtons&&wHelpButtons.forEach(e=>{let t=e.getAttribute("data-btnavailablety");e=e.getAttribute("data-timezone"),e=e?moment().tz(e):moment();is_available(JSON.parse(t),e).is_available?wHelpButtons.forEach(e=>{e.getAttribute("data-btnavailablety")===t&&(e.classList.add("avatar-active"),e.classList.add("ta_forms_analytics"),e.classList.remove("avatar-inactive"))}):wHelpButtons.forEach(e=>{e.getAttribute("data-btnavailablety")===t&&(e.classList.add("avatar-inactive"),e.classList.remove("ta_forms_analytics"),e.classList.remove("avatar-active"))})}),document.querySelector(".chat-availability"));if(chatAvailability){let o=chatAvailability.getAttribute("data-availability");if(void 0!==o){let e=chatAvailability.getAttribute("data-timezone"),t=e?moment().tz(e):moment(),a=is_available(JSON.parse(o),t);a.is_available||null==o?(chatAvailability.classList.add("avatar-active"),chatAvailability.classList.add("ta_forms_analytics"),chatAvailability.classList.remove("avatar-inactive"),wHelpCheckButton.forEach(e=>{e.classList.add("ta_forms_analytics"),chatAvailability.classList.remove("ta_forms_analytics")})):(wHelpCheckButton.forEach(e=>{e.classList.remove("ta_forms_analytics"),chatAvailability.classList.add("ta_forms_analytics")}),chatAvailability.classList.add("avatar-inactive"),chatAvailability.classList.remove("avatar-active"),chatAvailability.classList.remove("ta_forms_analytics"))}}function authShowPopup(){0!=autoShowPopup&&wHelp.forEach(e=>{e.classList?.toggle("wHelp-show")}),0!=autoShowPopup&&wHelpMulti.forEach(e=>{e.classList?.toggle("wHelp-show")})}(c=>{function t(e,o){e=document.querySelectorAll(e);0<e.length&&e.forEach(e=>{e&&e.addEventListener("click",()=>{var a,e=o.webhook_url,t=o.hook_values;e&&(t=Array.isArray(t)?t:[t],a={},t.forEach((e,t)=>{a["value"+(t+1)]=e}),c.ajax({url:e,type:"POST",contentType:"application/json",data:JSON.stringify(a),success:function(e){console.log("Webhook Response:",e)}}))})})}c("#form").length&&c("#form").validate(),wHelpPopupContent.forEach(r=>{let s=r.querySelector(".wHelp__send-message");c(r).submit(function(e){e.preventDefault();let n=c(this);n.valid()&&wHelpCheckButton.forEach(e=>{if(!e.classList.contains("condition__checked")){e=JSON.parse(chatAvailability?.getAttribute("data-availability"));if(e)if(is_available(e,moment()).is_available){var e=c(this).serialize(),o=window.location.href,l=document.title;let t=r.getAttribute("data-button"),a=r.getAttribute("data-loading");var i=r.getAttribute("data-product_attr");c.post(frontend_scripts.ajaxurl,{action:"handle_form_submission",data:e,product_id:i,nonce:frontend_scripts.nonce,current_url:o,current_title:l},e=>{e.success?(s.innerHTML=a,setTimeout(function(){window.open(e.data.whatsAppURL,frontend_scripts.open_in_new_tab),n[0].reset(),s.innerHTML=t},2e3)):alert("Error processing request.")}).fail(()=>alert("Unexpected error occurred.")),c.post(frontend_scripts.ajaxurl,{action:"handle_form_submission_webhook",data:e,nonce:frontend_scripts.nonce,webhook_url:frontend_scripts.webhook_url,the_title:frontend_scripts.the_title,current_url:window.location.href},function(e){var t,a,o;e&&(e=e.data,a=e.dynamic_data,t=e.form_data,e=e.webhook_url)&&(o=Array.isArray(a)?a:[a],a={},o.forEach((e,t)=>{a["value"+(t+1)]=e}),o=Object.assign({},t,a),o=JSON.stringify(o),c.ajax({url:e,type:"POST",mode:"no-cors",contentType:"application/json",data:o,success:function(e){console.log("Webhook Response:",e)}}))}).fail(function(){alert("Unexpected error occurred.")})}}})})}),c(".ta_forms_multi_user").on("click",function(){var l=c(this).find(".user__info--name").text().trim();c.post({url:frontend_scripts.ajaxurl,data:{action:"get_multi_user_details",the_title:frontend_scripts.the_title,current_url:window.location.href},success:function(e){var t,a,o;e.success&&(a=e.data.user_data,t=e.data.webhook_url,o=e.data.dynamic_data,e=a.find(e=>e.name===l))&&t&&(a={name:e.name,phone:e.phone},e=Array.isArray(o)?o:[o],o={},e.forEach((e,t)=>{o["value"+(t+1)]=e}),e=Object.assign({},a,o),c.ajax({url:t,type:"POST",contentType:"application/json",data:JSON.stringify(e),success:function(e){console.log("Webhook Response:",e)}}))}})}),t(".ta_forms_link",{webhook_url:frontend_scripts.webhook_url,hook_values:frontend_scripts.hook_v}),t(".woo_button_webhook",{webhook_url:frontend_scripts.woo_webhook_url,hook_values:frontend_scripts.woo_string}),document.querySelectorAll(".shortcode_button_webhook").forEach(e=>{e&&"undefined"!=typeof shortcode_scripts&&t(".shortcode_button_webhook",{webhook_url:shortcode_scripts.shortcode_webhook_url,hook_values:shortcode_scripts.shortcode_string})})})(jQuery),0<autoOpenPopupTimeout?setTimeout(authShowPopup,autoOpenPopupTimeout):authShowPopup();